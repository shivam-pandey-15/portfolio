# Research: 2.1 What a Query Really Is

## Beyond the Text Box
A query is not just text. It's a **compressed expression of user intent** with massive information loss.

---

## The Anatomy of a Query

### What the User Typed
```
running shoes
```

### What the User Actually Meant
```
{
  "intent": "purchase",
  "category": "athletic footwear",
  "activity": "running (jogging, not sprinting)",
  "gender": "inferred from user profile or unspecified",
  "size": "unknown (will filter later)",
  "price_range": "mid-range (assumed)",
  "brand_preference": "none specified",
  "urgency": "unknown",
  "context": "probably replacing old shoes"
}
```

### Information Lost in Compression
| Dimension | User Knows | System Knows |
|-----------|------------|--------------|
| Activity type | Running, not walking | Maybe (if good taxonomy) |
| Size | Their foot size | Only if logged in |
| Price sensitivity | Their budget | Only from past purchases |
| Brand preference | Their favorites | Only from history |
| Urgency | Need it tomorrow | Unknown |

---

## Query Components

### 1. Tokens (Words)
The raw text, split by whitespace or punctuation.
- "running shoes" → ["running", "shoes"]
- "men's nike air max" → ["men's", "nike", "air", "max"]

### 2. Entities
Named entities extracted from the query.
- Brand: "Nike", "Adidas"
- Category: "shoes", "laptop"
- Attribute: "red", "size 10", "under $100"
- Location: "near me", "in NYC"

### 3. Intent
What the user wants to DO with the results.
- **Navigational**: "Amazon login" → go to a specific page
- **Informational**: "how to clean running shoes" → learn something
- **Transactional**: "buy running shoes" → purchase

### 4. Context (Implicit)
Information not in the query but affects results.
- User location (IP, GPS)
- Device (mobile vs desktop)
- Time of day
- User history
- Session behavior

---

## Real-World Examples

### Example 1: "Apple"
| Possible Intent | Context That Resolves It |
|-----------------|--------------------------|
| Apple Inc (company) | Tech-focused user, search history |
| Apple (fruit) | Previous grocery searches |
| Apple Music | Music app context |
| Apple Store location | "near me" suffix, location services |

**Solution**: Entity disambiguation + user signals

### Example 2: "Python"
| Possible Intent | Context That Resolves It |
|-----------------|--------------------------|
| Python programming | Developer user, Stack Overflow in history |
| Python snake | Pet store browsing history |
| Monty Python | Entertainment context |

### Example 3: "Running shoes size 10 under $100"
This is a RICH query with multiple signals:
- Category: shoes
- Activity: running
- Attribute: size 10
- Price constraint: under $100
- Implicit: likely wants in-stock, good reviews

---

## Query Richness Spectrum

### Sparse Queries (Hard)
- "shoes" → Millions of results, no filtering
- "laptop" → What kind? For whom? What budget?

**Challenge**: Too little information. Need fallback strategies.

### Rich Queries (Easier)
- "men's nike air max 90 size 11 black" 
- Exact product match possible

**Challenge**: Inventory might not have exact match.

### Natural Language (Hardest)
- "I need something comfortable for my marathon next month"
- "that song from the movie with the car chase"

**Challenge**: Requires deep understanding, not just keyword matching.

---

## The Query Understanding Pipeline

```
Raw Query
    ↓
[Tokenization] → Split into words
    ↓
[Normalization] → Lowercase, remove accents, standardize
    ↓
[Spell Correction] → Fix typos
    ↓
[Entity Extraction] → Find brands, categories, attributes
    ↓
[Intent Classification] → Navigational? Transactional? Informational?
    ↓
[Query Expansion] → Add synonyms, related terms
    ↓
Processed Query → Ready for retrieval
```

---

## Common Mistakes

### Mistake 1: Treating Query as Literal
Query: "cheap laptop"
Bad: Search for documents containing "cheap" AND "laptop"
Good: Understand "cheap" = price range, sort by price

### Mistake 2: Ignoring Context
Query: "pizza"
Bad: Same results for everyone
Good: User in NYC → NYC pizza places. User browsing recipes → pizza recipes.

### Mistake 3: Over-Processing
Query: "iPhone 15 Pro Max 256GB Blue"
Bad: Expand to synonyms, add related terms (creates noise)
Good: This is already specific. Exact match first.

---

## The Query Contract

What a good query understanding system promises:
1. **Understand what the user probably means** (not just what they typed)
2. **Handle ambiguity gracefully** (ask for clarification or hedge)
3. **Preserve user intent** (don't over-correct or over-expand)
4. **Be fast** (query understanding must complete in <20ms)

---

## Key Takeaways

1. **A query is compressed intent**, not just text
2. **Context is as important as content** (who, where, when)
3. **Most queries are ambiguous** — the system must handle this
4. **Rich queries are easier than sparse queries** — but rarer
5. **The goal is intent satisfaction**, not keyword matching
