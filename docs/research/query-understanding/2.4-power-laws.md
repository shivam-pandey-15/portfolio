# Research: 2.4 Power Laws in Search

## The Fat Head and Long Tail
Query distribution follows a power law: a tiny fraction of queries generate most traffic.

---

## The Distribution

```
Query Frequency
    │
    │  ▓▓▓▓  ← Head: "amazon", "facebook" (1% of unique queries, 30% of volume)
    │   ▓▓▓▓▓▓
    │     ▓▓▓▓▓▓▓▓  ← Torso (10% of unique, 30% of volume)
    │        ▓▓▓▓▓▓▓▓▓▓▓
    │             ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓  ← Tail (89% of unique, 40% of volume)
    └───────────────────────────────────────→ Queries (ranked by frequency)
```

---

## Real Numbers from Industry

### Google (Public Estimates)
| Segment | % of Unique Queries | % of Traffic | Daily Volume |
|---------|---------------------|--------------|--------------|
| Head (top 100) | 0.0001% | ~5% | 425M searches |
| Head (top 10K) | 0.01% | ~15% | 1.3B searches |
| Torso (top 1M) | 1% | ~30% | 2.5B searches |
| Tail (rest) | 99% | ~55% | 4.7B searches |

**Key insight:** 15% of Google's traffic comes from just 10,000 unique queries.

### Amazon (E-commerce Pattern)
| Segment | Example Queries | Daily Frequency | Optimization |
|---------|-----------------|-----------------|--------------|
| Ultra-Head (Top 10) | "iPhone", "laptop", "headphones" | 10M+ | Dedicated teams |
| Head (Top 1K) | "running shoes", "wireless earbuds" | 100K-1M | Heavy caching |
| Torso (Top 100K) | "Nike running shoes men size 10" | 1K-100K | Category rules |
| Tail (1M+) | "blue sparkly kids light up sneakers size 3" | 1-100 | ML systems |
| One-shot | "my daughter's birthday gift unicorn theme" | 1 ever | LLM understanding |

### Flipkart (India Market)
| Period | Head Query Behavior | Tail Query Behavior |
|--------|---------------------|---------------------|
| Normal day | "mobile", "laptop" = 15% traffic | 60% of queries are unique |
| Big Billion Days | "mobile under 15000" = 25% traffic | Long-tail collapses to offers |
| Seasonal (Diwali) | "TV", "gold" spike 10x | Gift-related tail grows |

---

## Case Study: The Economics of Query Segments

### Head Query: "iPhone"
**Amazon Data (Estimated):**
- 50M searches/month
- Conversion rate: 3%
- Average order value: $900
- Monthly GMV from query: $1.35B

**Investment:**
- Dedicated merchandising team
- Manual result curation
- Real-time inventory integration
- Multiple A/B tests running simultaneously
- Custom landing page

**If ranking is wrong by 1 position:** ~$10M/month impact

### Torso Query: "men's running shoes"
**Data:**
- 500K searches/month
- Conversion rate: 4%
- Average order value: $120
- Monthly GMV: $24M

**Investment:**
- Category-level rules
- Automated brand balancing
- Size/color facet optimization
- Shared A/B testing

### Tail Query: "minimalist trail running shoes for wide feet size 11.5"
**Data:**
- 50 searches/month
- Conversion rate: 8% (high intent!)
- Average order value: $140
- Monthly GMV: $560

**Investment:**
- ML-based semantic matching
- Query relaxation strategies
- Zero-result fallback

---

## The Tail Problem: Why It's Hard

### Challenge 1: No Training Data
| Problem | Head Query | Tail Query |
|---------|------------|------------|
| Click data | Millions of clicks | 0-5 clicks |
| Conversion data | Statistical significance | No significance |
| A/B testing | Daily results | Never enough traffic |
| Manual review | Feasible | Impossible (too many) |

**Solution:** Transfer learning from head/torso, semantic understanding

### Challenge 2: Extreme Specificity
```
Query: "women's waterproof hiking boots size 8 wide width gore-tex under $200 with good ankle support light blue"

Constraints:
- Gender: women
- Category: hiking boots
- Size: 8
- Width: wide
- Material: gore-tex
- Price: max $200
- Feature: ankle support
- Color: light blue
- Feature: waterproof

Catalog:
- 10,000 hiking boots
- After all filters: 0 exact matches
```

**Solution:** Progressive relaxation
```
1. Try exact match (0 results)
2. Relax color (2 results)
3. Show "2 results, but here are close matches relaxing color..."
```

### Challenge 3: Natural Language in Tail
| Query | Parsing Challenge |
|-------|-------------------|
| "something to wear to my friend's outdoor summer wedding" | Event type, season, relationship, outdoor |
| "gift for my tech-savvy husband who has everything" | Gift intent, recipient profile, constraint |
| "comfortable shoes for someone who stands all day" | Use case, priority (comfort), duration |

**Solution:** LLM-based query understanding

---

## Strategies by Segment (Detailed)

### Head Query Strategy

#### Manual Curation
```python
HEAD_QUERY_RULES = {
    "iPhone": {
        "pin_results": ["iphone-15-pro", "iphone-15"],
        "boost_brands": ["Apple"],
        "demote_accessories": True,
        "show_comparison": True
    },
    "laptop": {
        "default_sort": "best_seller",
        "boost_categories": ["laptops", "chromebooks"],
        "demote": ["laptop_bags", "laptop_stands"]
    }
}
```

#### Dedicated Dashboard
- Real-time monitoring of top 100 queries
- Alerting on CTR drops > 5%
- Daily review of position changes
- Competitor comparison

#### Heavy Caching
```python
# Head queries cached for 5 minutes (vs 60 seconds for torso)
cache_ttl = {
    "head": 300,  # 5 minutes
    "torso": 60,  # 1 minute
    "tail": 0     # No cache
}
```

### Torso Query Strategy

#### Pattern-Based Rules
```python
TORSO_PATTERNS = [
    # [brand] + [category]
    {
        "pattern": r"^(?P<brand>\w+)\s+(?P<category>shoes|laptop|phone)$",
        "action": "boost_brand_in_category"
    },
    # [category] + "for" + [user_type]
    {
        "pattern": r"^(?P<category>\w+)\s+for\s+(?P<user>men|women|kids)$",
        "action": "filter_by_department"
    },
    # [category] + "under" + [price]
    {
        "pattern": r"^(?P<category>\w+)\s+under\s+\$?(?P<price>\d+)$",
        "action": "filter_by_price_max"
    }
]
```

#### Category-Level A/B Testing
```python
# Instead of testing individual queries:
experiment = {
    "name": "ranking_model_v2",
    "scope": "category:running_shoes",
    "traffic": 0.10,  # 10% of running shoes queries
    "metrics": ["ctr", "conversion", "revenue_per_search"]
}
```

### Tail Query Strategy

#### Semantic Matching
```python
# For tail queries, embedding similarity is primary signal
def search_tail_query(query: str) -> Results:
    # Get query embedding
    query_embedding = embedding_model.encode(query)
    
    # ANN search in vector index
    candidates = vector_index.search(query_embedding, k=1000)
    
    # Rerank with LTR model
    results = reranker.score(query, candidates)
    
    return results[:50]
```

#### Query Relaxation
```python
def search_with_relaxation(query, constraints):
    results = search(query, constraints)
    
    if len(results) < MIN_RESULTS:
        relaxation_order = ["color", "price", "size", "brand"]
        
        for field in relaxation_order:
            if field in constraints:
                relaxed = constraints.copy()
                del relaxed[field]
                results = search(query, relaxed)
                
                if len(results) >= MIN_RESULTS:
                    return results, f"Showing results without {field} filter"
    
    return results, None
```

#### Fallback Strategies
```python
def tail_fallback_cascade(query):
    # Level 1: Exact + Semantic hybrid
    results = hybrid_search(query)
    if results: return results
    
    # Level 2: Category-based fallback
    category = extract_category(query)
    if category:
        results = get_category_bestsellers(category)
        if results: return results, "Popular in this category"
    
    # Level 3: Trending items
    return get_trending_items(), "Trending items you might like"
```

---

## Investment Matrix

| Segment | Engineering Investment | Business Investment | Automation Level |
|---------|------------------------|---------------------|------------------|
| Head | High (dedicated team) | Very High (merchandising) | Low (manual) |
| Torso | Medium | Medium | Medium |
| Tail | Low (infrastructure) | Low | Very High (must be) |

### Budget Allocation (Typical)
| Segment | % of Search Budget | Expected Impact |
|---------|-------------------|-----------------|
| Head optimization | 40% | 50% of improvement |
| Torso systems | 30% | 30% of improvement |
| Tail ML/infra | 30% | 20% of improvement |

---

## Measuring by Segment

### Segment-Specific Dashboards

#### Head Dashboard
| Metric | Query: "iPhone" | Alert Threshold |
|--------|-----------------|-----------------|
| CTR | 45% | < 40% |
| Position 1 CTR | 28% | < 25% |
| Conversion | 3.2% | < 2.8% |
| Revenue/Search | $27.00 | < $25.00 |

#### Torso Dashboard
| Metric | Category: Running Shoes | Alert Threshold |
|--------|-------------------------|-----------------|
| Avg CTR | 38% | < 32% |
| Zero Result Rate | 1.2% | > 3% |
| Avg Position of First Click | 2.1 | > 3.0 |

#### Tail Dashboard
| Metric | All Tail Queries | Goal |
|--------|------------------|------|
| Zero Result Rate | 4.5% | < 5% |
| Fallback Usage | 12% | < 15% |
| Semantic Match Rate | 78% | > 75% |

---

## Key Takeaways

1. **1% of queries = 30% of traffic** — head matters enormously
2. **99% of queries are tail** — but collectively significant
3. **Head = manual tuning, Tail = automation** — different strategies
4. **Tail is where ML shines** — can't manually tune 10M queries
5. **Measure by segment** — what works for head doesn't work for tail
6. **Tail users have high intent** — 8% conversion vs 3% for head
7. **Investment follows impact** — but tail infra enables scale
8. **Head failures are catastrophic** — 1 position change = millions lost
